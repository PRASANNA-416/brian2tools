

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>NeuroML exporter &mdash; brian2tools  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Markdown exporter" href="markdown_developer.html" />
    <link rel="prev" title="Coding guidelines" href="coding.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> brian2tools
          

          
          </a>

          
            
            
              <div class="version">
                0.2.1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User’s guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer’s guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="coding.html">Coding guidelines</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">NeuroML exporter</a></li>
<li class="toctree-l2"><a class="reference internal" href="markdown_developer.html">Markdown exporter</a></li>
<li class="toctree-l2"><a class="reference internal" href="releases.html">Release procedure</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/brian2tools.html">brian2tools package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">brian2tools</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Developer’s guide</a> &raquo;</li>
        
      <li>NeuroML exporter</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/developer/exporter_developer.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="neuroml-exporter">
<h1>NeuroML exporter<a class="headerlink" href="#neuroml-exporter" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="overview">
<p class="topic-title">Overview</p>
<ul class="simple">
<li><p><a class="reference internal" href="#nmlexporter" id="id1">NMLExporter</a></p>
<ul>
<li><p><a class="reference internal" href="#neuron-group" id="id2">Neuron Group</a></p></li>
<li><p><a class="reference internal" href="#dom-structure" id="id3">DOM structure</a></p></li>
<li><p><a class="reference internal" href="#model-namespace" id="id4">Model namespace</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#lemsdevice" id="id5">LEMSDevice</a></p>
<ul>
<li><p><a class="reference internal" href="#lems-unit-constants" id="id6">LEMS Unit Constants</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#other-modules" id="id7">Other modules</a></p></li>
<li><p><a class="reference internal" href="#todo" id="id8">TODO</a></p></li>
</ul>
</div>
<p>The main work of the exporter is done in the <a class="reference internal" href="../reference/brian2tools.nmlexport.lemsexport.html#module-brian2tools.nmlexport.lemsexport" title="brian2tools.nmlexport.lemsexport"><code class="xref py py-obj docutils literal notranslate"><span class="pre">lemsexport</span></code></a>
module.</p>
<p>It consists of two main classes:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../reference/brian2tools.nmlexport.lemsexport.html#brian2tools.nmlexport.lemsexport.NMLExporter" title="brian2tools.nmlexport.lemsexport.NMLExporter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NMLExporter</span></code></a> - responsible for building
the NeuroML2/LEMS model.</p></li>
<li><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">LEMSDevice</span></code> - responsible for code
generation. It gathers all variables needed to describe the model and calls
<code class="docutils literal notranslate"><span class="pre">NMLExporter</span></code> with well-prepared parameters.</p></li>
</ul>
<div class="section" id="nmlexporter">
<h2><a class="toc-backref" href="#id1">NMLExporter</a><a class="headerlink" href="#nmlexporter" title="Permalink to this headline">¶</a></h2>
<p>The whole process of building NeuroML model starts with calling the
<code class="docutils literal notranslate"><span class="pre">create_lems_model</span></code> method. It selects crucial Brian 2 objects to further
parse and pass them to respective methods.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">network</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">net</span> <span class="o">=</span> <span class="n">Network</span><span class="p">(</span><span class="n">collect</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">net</span> <span class="o">=</span> <span class="n">network</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">constants_file</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">lems</span><span class="o">.</span><span class="n">Include</span><span class="p">(</span><span class="n">LEMS_CONSTANTS_XML</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">lems</span><span class="o">.</span><span class="n">Include</span><span class="p">(</span><span class="n">constants_file</span><span class="p">))</span>
<span class="n">includes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">includes</span><span class="p">)</span>
<span class="k">for</span> <span class="n">incl</span> <span class="ow">in</span> <span class="n">INCLUDES</span><span class="p">:</span>
    <span class="n">includes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">incl</span><span class="p">)</span>
<span class="n">neuron_groups</span>  <span class="o">=</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">net</span><span class="o">.</span><span class="n">objects</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="ow">is</span> <span class="n">NeuronGroup</span><span class="p">]</span>
<span class="n">state_monitors</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">net</span><span class="o">.</span><span class="n">objects</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="ow">is</span> <span class="n">StateMonitor</span><span class="p">]</span>
<span class="n">spike_monitors</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">net</span><span class="o">.</span><span class="n">objects</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="ow">is</span> <span class="n">SpikeMonitor</span><span class="p">]</span>

<span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">net</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">NeuronGroup</span><span class="p">,</span> <span class="n">StateMonitor</span><span class="p">,</span> <span class="n">SpikeMonitor</span><span class="p">,</span>
                       <span class="n">Thresholder</span><span class="p">,</span> <span class="n">Resetter</span><span class="p">,</span> <span class="n">StateUpdater</span><span class="p">]:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="si">{}</span><span class="s2"> export functionality</span>
<span class="s2">                       is not implemented yet.&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>

<span class="c1"># Thresholder, Resetter, StateUpdater are not interesting from our perspective</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">netinputs</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
    <span class="n">includes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">LEMS_INPUTS</span><span class="p">)</span>
<span class="k">for</span> <span class="n">incl</span> <span class="ow">in</span> <span class="n">includes</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_include</span><span class="p">(</span><span class="n">incl</span><span class="p">)</span>
<span class="c1"># First step is to add individual neuron deifinitions and initialize</span>
<span class="c1"># them by MultiInstantiate</span>
<span class="k">for</span> <span class="n">e</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">neuron_groups</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_neurongroup</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">initializers</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="neuron-group">
<h3><a class="toc-backref" href="#id2">Neuron Group</a><a class="headerlink" href="#neuron-group" title="Permalink to this headline">¶</a></h3>
<p>A method <code class="docutils literal notranslate"><span class="pre">add_neurongroup</span></code> requires more attention. This is the method
responsible for building cell model in LEMS (as so-called <code class="docutils literal notranslate"><span class="pre">ComponentType</span></code>)
and initializing it when necessary.</p>
<p>In order to build a whole network of cells with different initial values,
we need to use the <code class="docutils literal notranslate"><span class="pre">MultiInstantiate</span></code> LEMS tag. A method <code class="docutils literal notranslate"><span class="pre">make_multiinstantiate</span></code>
does this job. It iterates over all parameters and analyses equation
to find those with iterator variable <code class="docutils literal notranslate"><span class="pre">i</span></code>. Such variables are initialized
in a <code class="docutils literal notranslate"><span class="pre">MultiInstantiate</span></code> loop at the beginning of a simulation.</p>
<p>More details about the methods described above can be found in the code comments.</p>
</div>
<div class="section" id="dom-structure">
<h3><a class="toc-backref" href="#id3">DOM structure</a><a class="headerlink" href="#dom-structure" title="Permalink to this headline">¶</a></h3>
<p>Until this point the whole model is stored in <code class="xref py py-obj docutils literal notranslate"><span class="pre">NMLExporter._model</span></code>, because
the method <code class="docutils literal notranslate"><span class="pre">add_neurongroup</span></code> takes advantage of <code class="docutils literal notranslate"><span class="pre">pylems</span></code> module to create
a XML structure. After that we export it to <code class="docutils literal notranslate"><span class="pre">self._dommodel</span></code> and rather
use NeuroML2 specific content. To extend it one may use
<code class="docutils literal notranslate"><span class="pre">self._extend_dommodel()</span></code> method, giving as parameter a proper DOM structure
(built for instance using python <code class="docutils literal notranslate"><span class="pre">xml.dom.minidom</span></code>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># DOM structure of the whole model is constructed below</span>
<span class="bp">self</span><span class="o">.</span><span class="n">_dommodel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">export_to_dom</span><span class="p">()</span>
<span class="c1"># input support - currently only Poisson Inputs</span>
<span class="k">for</span> <span class="n">e</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">netinputs</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">counter</span><span class="o">=</span><span class="n">e</span><span class="p">)</span>
<span class="c1"># A population should be created in *make_multiinstantiate*</span>
<span class="c1"># so we can add it to our DOM structure.</span>
<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_population</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_extend_dommodel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_population</span><span class="p">)</span>
<span class="c1"># if some State or Spike Monitors occur we support them by</span>
<span class="c1"># Simulation tag</span>
<span class="bp">self</span><span class="o">.</span><span class="n">_model_namespace</span><span class="p">[</span><span class="s1">&#39;simulname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;sim1&quot;</span>
<span class="bp">self</span><span class="o">.</span><span class="n">_simulation</span> <span class="o">=</span> <span class="n">NeuroMLSimulation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_namespace</span><span class="p">[</span><span class="s1">&#39;simulname&#39;</span><span class="p">],</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">_model_namespace</span><span class="p">[</span><span class="s1">&#39;networkname&#39;</span><span class="p">])</span>
<span class="k">for</span> <span class="n">e</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">state_monitors</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_statemonitor</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">recordingsname</span><span class="p">,</span> <span class="n">outputfile</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">e</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">spike_monitors</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_spikemonitor</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">recordingsname</span><span class="p">)</span>
</pre></div>
</div>
<p>Some of the NeuroML structures are already implemented in <code class="docutils literal notranslate"><span class="pre">supporting.py</span></code>. For example:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">NeuroMLSimulation</span></code> - describes Simulation, adds plot and lines, adds outputfiles for spikes and voltage recordings;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NeuroMLSimpleNetwork</span></code> - creates a network of cells given some ComponentType;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NeuroMLTarget</span></code> - picks target for simulation runner.</p></li>
</ul>
<p>At the end of the model parsing, a simulation tag is built and added with a target pointing to it.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">simulation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simulation</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="bp">self</span><span class="o">.</span><span class="n">_extend_dommodel</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">NeuroMLTarget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_namespace</span><span class="p">[</span><span class="s1">&#39;simulname&#39;</span><span class="p">])</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="bp">self</span><span class="o">.</span><span class="n">_extend_dommodel</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</pre></div>
</div>
<p>You may access the final DOM structure by accessing the <code class="docutils literal notranslate"><span class="pre">model`</span></code> property or
export it to a XML file by calling the <code class="docutils literal notranslate"><span class="pre">export_to_file()</span></code> method of the
<code class="docutils literal notranslate"><span class="pre">NMLExporter</span></code> object.</p>
</div>
<div class="section" id="model-namespace">
<h3><a class="toc-backref" href="#id4">Model namespace</a><a class="headerlink" href="#model-namespace" title="Permalink to this headline">¶</a></h3>
<p>In many places of the code a dictionary <code class="docutils literal notranslate"><span class="pre">self._model_namespace</span></code> is used.
As LEMS used identifiers <code class="docutils literal notranslate"><span class="pre">id</span></code> to name almost all of its components, we
want to be consistent in naming them. The dictionary stores names of
model’s components and allows to refer it later in the code.</p>
</div>
</div>
<div class="section" id="lemsdevice">
<h2><a class="toc-backref" href="#id5">LEMSDevice</a><a class="headerlink" href="#lemsdevice" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">LEMSDevice</span></code> allows you to take advantage of Brian 2’s code generation mechanism.
It makes usage of the module easier, as it means for user that they just
need to import <code class="docutils literal notranslate"><span class="pre">brian2tools.nmlexport</span></code> and set the device
<code class="docutils literal notranslate"><span class="pre">neuroml2</span></code> like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">brian2lems.nmlexport</span>

<span class="n">set_device</span><span class="p">(</span><span class="s1">&#39;neuroml2&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;ifcgmtest.xml&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>In the class init a flag <code class="docutils literal notranslate"><span class="pre">self.build_on_run</span></code> was set to <code class="docutils literal notranslate"><span class="pre">True</span></code> which
means that exporter starts working immediately after encountering the <code class="docutils literal notranslate"><span class="pre">run</span></code>
statement.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">LEMSDevice</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">runs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assignments</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">build_on_run</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">build_options</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">has_been_run</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<p>First of all method <code class="docutils literal notranslate"><span class="pre">network_run</span></code> is called which gathers of necessary
variables from the script or function namespaces and passes it to <code class="docutils literal notranslate"><span class="pre">build</span></code>
method. In <code class="docutils literal notranslate"><span class="pre">build</span></code> we select all needed variables to separate dictionaries,
create a name of the recording files and eventually build the exporter.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">initializers</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">descriptions</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">assignments</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">runs</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">assignment</span> <span class="ow">in</span> <span class="n">assignments</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">assignment</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="n">initializers</span><span class="p">:</span>
            <span class="n">initializers</span><span class="p">[</span><span class="n">assignment</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">assignment</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">runs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Currently only single run is supported.&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
    <span class="n">filename_</span> <span class="o">=</span> <span class="s1">&#39;recording_&#39;</span> <span class="o">+</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">filename_</span> <span class="o">=</span> <span class="s1">&#39;recording_&#39;</span> <span class="o">+</span> <span class="n">filename</span>
<span class="n">exporter</span> <span class="o">=</span> <span class="n">NMLExporter</span><span class="p">()</span>
<span class="n">exporter</span><span class="o">.</span><span class="n">create_lems_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">,</span>
                                         <span class="n">initializers</span><span class="o">=</span><span class="n">initializers</span><span class="p">,</span>
                                         <span class="n">recordingsname</span><span class="o">=</span><span class="n">filename_</span><span class="p">)</span>
<span class="n">exporter</span><span class="o">.</span><span class="n">export_to_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="lems-unit-constants">
<h3><a class="toc-backref" href="#id6">LEMS Unit Constants</a><a class="headerlink" href="#lems-unit-constants" title="Permalink to this headline">¶</a></h3>
<p>Last lines of the method are saving <code class="docutils literal notranslate"><span class="pre">LemsConstantUnit.xml</span></code> file
alongside with our model file. This is due to the fact that in some places
of mathematical expressions LEMS requires unitless variables, e.g. instead of
<code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">mm</span></code> it wants <code class="docutils literal notranslate"><span class="pre">0.001</span></code>. So we store most popular units transformed to
constants in a separate file which is included in the model file header.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">lems_const_save</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">nmlcdpath</span><span class="p">,</span> <span class="n">LEMS_CONSTANTS_XML</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">LEMS_CONSTANTS_XML</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="other-modules">
<h2><a class="toc-backref" href="#id7">Other modules</a><a class="headerlink" href="#other-modules" title="Permalink to this headline">¶</a></h2>
<p>If you want to know more about other scripts included in package
( <a class="reference internal" href="../reference/brian2tools.nmlexport.lemsrendering.html#module-brian2tools.nmlexport.lemsrendering" title="brian2tools.nmlexport.lemsrendering"><code class="xref py py-obj docutils literal notranslate"><span class="pre">lemsrendering</span></code></a>, <a class="reference internal" href="../reference/brian2tools.nmlexport.supporting.html#module-brian2tools.nmlexport.supporting" title="brian2tools.nmlexport.supporting"><code class="xref py py-obj docutils literal notranslate"><span class="pre">supporting</span></code></a>,
<a class="reference internal" href="../reference/brian2tools.nmlexport.cgmhelper.html#module-brian2tools.nmlexport.cgmhelper" title="brian2tools.nmlexport.cgmhelper"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cgmhelper</span></code></a>), please read their docstrings or comments
included in the code.</p>
</div>
<div class="section" id="todo">
<h2><a class="toc-backref" href="#id8">TODO</a><a class="headerlink" href="#todo" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>synapses support;</p></li>
</ul>
<p>First attempt to make synapses export work was made during GSOC period. The problem with that
feature is related to the fact that NeuroML and brian2 internal synapses implementation differs substantially.
For instance, in NeuroML there are no predefined rules for connections, but user needs to explicitly define a synapse.
Moreover, in Brian 2, for efficiency reasons, postsynaptic potentials are
normally modeled in the post-synaptic cell (for linearly summating synapses,
this is equivalent but much more efficient), whereas in NeuroML they are modeled
as part of the synapse (simulation speed is not an issue here).</p>
<ul class="simple">
<li><p>network input support;</p></li>
</ul>
<p>Although there are some classes supporting <code class="docutils literal notranslate"><span class="pre">PoissonInput</span></code> in the <code class="docutils literal notranslate"><span class="pre">supporting.py</span></code>, full functionality
of  input is still not provided, as it is stongly linked with above synapses problems.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="markdown_developer.html" class="btn btn-neutral float-right" title="Markdown exporter" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="coding.html" class="btn btn-neutral float-left" title="Coding guidelines" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Brian authors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>